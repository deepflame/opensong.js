/*! opensong 2014-04-09 */
var Handlebars={};!function(a,b){a.VERSION="1.0.0",a.COMPILER_REVISION=4,a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},a.helpers={},a.partials={};var c=Object.prototype.toString,d="[object Function]",e="[object Object]";a.registerHelper=function(b,d,f){if(c.call(b)===e){if(f||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,b)}else f&&(d.not=f),this.helpers[b]=d},a.registerPartial=function(b,d){c.call(b)===e?a.Utils.extend(this.partials,b):this.partials[b]=d},a.registerHelper("helperMissing",function(a){if(2===arguments.length)return b;throw new Error("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,e){var f=e.inverse||function(){},g=e.fn,h=c.call(b);return h===d&&(b=b.call(this)),b===!0?g(this):b===!1||null==b?f(this):"[object Array]"===h?b.length>0?a.helpers.each(b,e):f(this):g(b)}),a.K=function(){},a.createFrame=Object.create||function(b){a.K.prototype=b;var c=new a.K;return a.K.prototype=null,c},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!=typeof console&&console[d]&&console[d].call(console,c)}}},a.log=function(b,c){a.logger.log(b,c)},a.registerHelper("each",function(b,e){var f,g=e.fn,h=e.inverse,i=0,j="",k=c.call(b);if(k===d&&(b=b.call(this)),e.data&&(f=a.createFrame(e.data)),b&&"object"==typeof b)if(b instanceof Array)for(var l=b.length;l>i;i++)f&&(f.index=i),j+=g(b[i],{data:f});else for(var m in b)b.hasOwnProperty(m)&&(f&&(f.key=m),j+=g(b[m],{data:f}),i++);return 0===i&&(j=h(this)),j}),a.registerHelper("if",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),!b||a.Utils.isEmpty(b)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})}),a.registerHelper("with",function(b,e){var f=c.call(b);return f===d&&(b=b.call(this)),a.Utils.isEmpty(b)?void 0:e.fn(b)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)});var f=["description","fileName","lineNumber","message","name","number","stack"];a.Exception=function(){for(var a=Error.prototype.constructor.apply(this,arguments),b=0;b<f.length;b++)this[f[b]]=a[f[b]]},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()};var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h=/[&<>"'`]/g,i=/[&<>"'`]/,j=function(a){return g[a]||"&amp;"};a.Utils={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){return b instanceof a.SafeString?b.toString():null==b||b===!1?"":(b=b.toString(),i.test(b)?b.replace(h,j):b)},isEmpty:function(a){return a||0===a?"[object Array]"===c.call(a)&&0===a.length?!0:!1:!0}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?e=a.VM.program(b,c,d):e||(e=this.programs[b]=a.VM.program(b,c)),e},merge:function(b,c){var d=b||c;return b&&c&&(d={},a.Utils.extend(d,c),a.Utils.extend(d,b)),d},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,i=a.COMPILER_REVISION;if(h!==i){if(i>h){var j=a.REVISION_CHANGES[i],k=a.REVISION_CHANGES[h];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+j+") or downgrade your runtime to an older version ("+k+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+")."}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e},program:function(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d},noop:function(){return""},invokePartial:function(c,d,e,f,g,h){var i={helpers:f,partials:g,data:h};if(c===b)throw new a.Exception("The partial "+d+" could not be found");if(c instanceof Function)return c(e,i);if(a.compile)return g[d]=a.compile(c,{data:h!==b}),g[d](e,i);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode")}},a.template=a.VM.template}(Handlebars);var opensong;opensong=opensong||{},opensong.helper=opensong.helper||{},opensong.helper.transposeChord=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(f=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B","C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],j=[],n=a.split("/"),l=0,m=n.length;m>l;l++){if(c=n[l],h=/^([A-G][#b]?)(.*)$/.exec(c),!h)return a;k=h[0],e=h[1],d=h[2],g=f.indexOf(e),0>g?j.push(c):(i=(g+b+f.length)%(f.length/2),j.push(f[i]+d))}return j.join("/")},opensong.helper.humanizeHeader=function(a){var b,c,d,e;return e={C:"Chorus",V:"Verse",B:"Bridge",T:"Tag",P:"Pre-Chorus"},d=new RegExp("^(["+Object.keys(e).join("")+"])(.*)$","i"),(b=d.exec(a))?(b=b.slice(1),""===b[1]&&b.pop(),c=b[0].toUpperCase(),b[0]=e[c],"undefined"!=typeof i18n&&null!==i18n&&(b[0]=i18n.t("header."+b[0].toLowerCase())),b.join(" ")):a},opensong.helper.cleanLyrics=function(a){var b;return b=/_|\||---|-!!/g,a.replace(b,"")};var opensong;opensong=opensong||{},opensong.helper=opensong.helper||{},opensong.helper.parseLyrics=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(a=a.replace(/\r\n?/g,"\n"),k=a.split("\n"),f=[],g={header:void 0,lines:[]},f.push(g);k.length>0;)if(j=k.shift(),null!=j)switch(j[0]){case"[":g.lines.length>0&&(g={header:void 0,lines:[]},f.push(g)),h=j.match(/\[(.*)\]/)[1],g.header=h;break;case".":for(e=j.substr(1),b=[];e.length>0;)l=/^(\S*\s*)(.*)/.exec(e),b.push(l[1]),e=l[2];for(0===b.length&&b.push(e),c=[],b.forEach(function(a){return l=/(\S*\s?)\s*/.exec(a),c.push(l[1])}),n="",o=[],l=null;(n=k.shift())&&(l=n.match(/^([ 1-9])(.*)/));){m=[],p=l[1],n=l[2];for(i in b)i<b.length-1?(d=b[i].length,l=n.match(new RegExp("(.{0,"+d+"})(.*)")),m.push(l[1]),n=l[2]):m.push(n);o.push(m)}g.lines.push({chords:c,lyrics:o.length>0?o:void 0}),"undefined"!==n&&k.unshift(n);break;case";":g.lines.push({comments:j.substr(1)});break;default:/^[ 0-9]/.test(j)&&g.lines.push({lyrics:[j.substr(1)]})}return f},"object"==typeof module&&(module.exports.parse=opensong.helper.parseLyrics),this.JST=this.JST||{},this.JST["src/opensong.hbs"]=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+='\n<div class="song-section">\n\n',d=c["if"].call(a,a.header,{hash:{},inverse:t.noop,fn:t.program(2,g,b),data:b}),(d||0===d)&&(f+=d),f+="\n\n",e={hash:{},inverse:t.noop,fn:t.program(4,h,b),data:b},(d=c.lines)?d=d.call(a,e):(d=a.lines,d=typeof d===s?d.apply(a):d),c.lines||(d=u.call(a,d,e)),(d||0===d)&&(f+=d),f+="\n\n</div>\n"}function g(a,b){var d,e,f="";return f+='\n<h2 class="header">',e={hash:{},data:b},f+=r((d=c.human_header||a.human_header,d?d.call(a,a.header,e):q.call(a,"human_header",a.header,e)))+"</h2>\n"}function h(a,b){var d,e,f,g="";return g+="\n\n\n",f={hash:{},inverse:t.noop,fn:t.program(5,i,b),data:b},d=c.if_or||a.if_or,e=d?d.call(a,a.lyrics,a.chords,f):q.call(a,"if_or",a.lyrics,a.chords,f),(e||0===e)&&(g+=e),g+="\n\n\n",e=c["if"].call(a,a.comments,{hash:{},inverse:t.noop,fn:t.program(11,m,b),data:b}),(e||0===e)&&(g+=e),g+="\n\n"}function i(a,b){var d,e,f="";return f+='\n<table>\n	<tr class="chords">\n		',e={hash:{},inverse:t.noop,fn:t.program(6,j,b),data:b},(d=c.chords)?d=d.call(a,e):(d=a.chords,d=typeof d===s?d.apply(a):d),c.chords||(d=u.call(a,d,e)),(d||0===d)&&(f+=d),f+="\n	</tr>\n	",e={hash:{},inverse:t.noop,fn:t.program(8,k,b),data:b},(d=c.lyrics)?d=d.call(a,e):(d=a.lyrics,d=typeof d===s?d.apply(a):d),c.lyrics||(d=u.call(a,d,e)),(d||0===d)&&(f+=d),f+="\n</table>\n"}function j(a,b){var d,e,f="";return f+="\n		<td>",e={hash:{},data:b},f+=r((d=c.transpose||a.transpose,d?d.call(a,a,e):q.call(a,"transpose",a,e)))+"</td>\n		"}function k(a,b){var c,d,e="";return e+="\n	<tr class='lyrics'>\n		",c=typeof a===s?a.apply(a):a,d=u.call(a,c,{hash:{},inverse:t.noop,fn:t.program(9,l,b),data:b}),(d||0===d)&&(e+=d),e+="\n	</tr>\n	"}function l(a,b){var d,e,f="";return f+="\n		<td>",e={hash:{},data:b},f+=r((d=c.clean_lyrics||a.clean_lyrics,d?d.call(a,a,e):q.call(a,"clean_lyrics",a,e)))+"</td>\n		"}function m(a,b){var d,e="";return e+='\n<div class="comments">\n  ',(d=c.comments)?d=d.call(a,{hash:{},data:b}):(d=a.comments,d=typeof d===s?d.apply(a):d),e+=r(d)+"\n</div>\n"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var n,o,p="",q=c.helperMissing,r=this.escapeExpression,s="function",t=this,u=c.blockHelperMissing;return n=typeof b===s?b.apply(b):b,o=u.call(b,n,{hash:{},inverse:t.noop,fn:t.program(1,f,e),data:e}),(o||0===o)&&(p+=o),p+="\n"});var opensong;opensong=opensong||{},opensong.helper=opensong.helper||{},opensong.Song=function(){function a(a,b){this.el=c(a),this.tpl=window.JST["src/opensong.hbs"],this.setLyrics(b)}var b,c,d;return d=Object.prototype.toString,b="[object Function]",a.prototype.transpose=function(a){return Handlebars.registerHelper("transpose",function(b){return opensong.helper.transposeChord(b,a||0)}),this.renderLyrics()},a.prototype.setLyrics=function(a){return this.model=opensong.helper.parseLyrics(a),this.renderLyrics()},a.prototype.getModel=function(){return this.model},a.prototype.renderLyrics=function(){return this.el.innerHTML=this.tpl(this.model),/opensong/.test(this.el.className)?void 0:this.el.className+=" opensong"},c=function(a){return"string"==typeof a?document.getElementById(a):a.jquery?a.get(0):a.nodeType?a:void 0},Handlebars.registerHelper("human_header",function(a){return opensong.helper.humanizeHeader(a)}),Handlebars.registerHelper("transpose",function(a){return a}),Handlebars.registerHelper("clean_lyrics",function(a){return opensong.helper.cleanLyrics(a)}),Handlebars.registerHelper("if_or",function(a,b,c){return Handlebars.Utils.isEmpty(a)&&Handlebars.Utils.isEmpty(b)?c.inverse(this):c.fn(this)}),a}();